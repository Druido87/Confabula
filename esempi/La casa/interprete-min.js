document.addEventListener("keydown",function(b){if(b.shiftKey&&b.keyCode===9){b.preventDefault();Vista.annullaTabLink();G.pronto()}else{if(b.keyCode===9){b.preventDefault();var c=document.getElementsByClassName("scelta");for(var a=0;a<c.length;a++){if(c[a].classList.contains("tabLink")){c[a].classList.remove("tabLink");if(a+1<c.length){c[a+1].classList.add("tabLink");document.getElementById("input").blur()}else{G.pronto()}return}}c[0].classList.add("tabLink");document.getElementById("input").blur()}else{if(b.keyCode===13||b.keyCode===32){var c=document.getElementsByClassName("tabLink");if(c.length!==0){b.preventDefault();c[0].click()}}}}});var Lingua={equivalenzeOrd:{},mappaDiacritici:[{base:"à",letters:/[\u00e0\u00e1]/g},{base:"è",letters:/[\u00e8\u00e9]/g},{base:"i",letters:/[\u00eC\u00ed\u00ee]/g},{base:"ò",letters:/[\u00f2\u00f3]/g},{base:"u",letters:/[\u00f9\u00fa]/g}],equivalenze:function(e){for(var b=0;b<e.length;b++){e[b]=e[b][0].split("|");for(var d=0;d<e[b].length;d++){if(!(e[b][d] in Lingua.equivalenzeOrd)){if(!e[b][d].match(/['‛‘’`´]+/)&&e[b][d]!=""){Lingua.equivalenzeOrd[e[b][d]]=[]}}}}for(var a in Lingua.equivalenzeOrd){for(var b=0;b<e.length;b++){if(e[b].indexOf(a)!==-1){Lingua.equivalenzeOrd[a].push(e[b])}}}for(var a in Lingua.equivalenzeOrd){var c=[];for(var b=0;b<Lingua.equivalenzeOrd[a].length;b++){if(Lingua.equivalenzeOrd[a][b][0]===""){c.push("__"+Lingua.equivalenzeOrd[a][b][1])}else{c.push(Lingua.equivalenzeOrd[a][b][0])}}Lingua.equivalenzeOrd[a]=c;if(Lingua.equivalenzeOrd[a].length===1&&a===Lingua.equivalenzeOrd[a][0]){delete Lingua.equivalenzeOrd[a]}}},normalizzaImperativo:function(b){if(b.length===1||(b.substr(-1,1)!=="a"&&b.substr(-1,1)!=="i")){return b}var a={abbi:"ho",accogli:"accolgo",addivieni:"addivengo",adempi:"adempio",anteponi:"antepongo",appari:"appaio",appartieni:"appartengo",apponi:"appongo",assali:"assalgo",astieni:"astengo",astrai:"astraggo",attieni:"attengo",attrai:"attraggo",avvali:"avvalgo",avvieni:"avvengo",circonvieni:"circonvengo",cogli:"colgo",compari:"compaio",compi:"compio",compiaci:"compiaccio",componi:"compongo",conduoli:"condolgo",confa:"confaccio",confai:"confaccio",contieni:"contengo",contraffai:"contraffaccio",contrai:"contraggo",contrapponi:"contrappongo",contravvieni:"contravvengo",convieni:"convengo",cuci:"cucio",cuoci:"cuocio",da:"do",dai:"do",decomponi:"decompongo",deponi:"depongo",detieni:"detengo",detrai:"detraggo",di:"dico",disassuefai:"disassuefaccio",disciogli:"disciolgo",discomponi:"discompongo",disconvieni:"disconvengo",disfa:"disfaccio","disfà":"disfaccio",dispari:"dispaio",dispiaci:"dispiaccio",disponi:"dispongo",distogli:"distolgo",distrai:"distraggo",disvogli:"disvoglio",divieni:"divengo",duoli:"dolgo",empi:"empio",equivali:"equivalgo",esponi:"espongo",estrai:"estraggo",fa:"faccio",fai:"faccio",frapponi:"frappongo",giaci:"giaccio",giustapponi:"giustappongo",imponi:"impongo",incogli:"incolgo",indi:"indico",indisponi:"indispongo",interdi:"interdico",interponi:"interpongo",intervieni:"intervengo",intrattieni:"intrattengo",invali:"invalgo",liquefa:"liquefaccio",liquefai:"liquefaccio",malfa:"malfaccio",malfai:"malfaccio",mantieni:"mantengo",molci:"molcio",muori:"muoio",nuoci:"nuoccio",opponi:"oppongo",ottieni:"ottengo",pari:"paio",permani:"permango",pervieni:"pervengo",piaci:"piaccio",poni:"pongo",posponi:"pospongo",predi:"predico",predisponi:"predispongo",premuori:"premuoio",preponi:"prepongo",prescegli:"prescelgo",presupponi:"presuppongo",prevali:"prevalgo",previeni:"prevengo",proponi:"propongo",prosciogli:"prosciolgo",protrai:"protraggo",provieni:"provengo",puoi:"posso",putrefai:"putrefaccio",raccogli:"raccolgo",rarefai:"rarefaccio",rattieni:"rattengo",reci:"recio",redi:"redico",retrai:"retraggo",riabbi:"riò",riabbia:"riò",riai:"riò",riappari:"riappaio",riassali:"riassalgo",ricogli:"ricolgo",ricompari:"ricompaio",ricomponi:"ricompongo",riconvieni:"riconvengo",ricuci:"ricucio",ricuoci:"ricuocio",rida:"ridò","ridà":"ridò",ridai:"ridò",ridi:"ridico",ridisponi:"ridispongo",riempi:"riempio",rifa:"rifaccio",rifai:"rifaccio",rimani:"rimango",rinvieni:"rinvengo",riponi:"ripongo",riproponi:"ripropongo",risali:"risalgo",risappi:"riso",riscegli:"riscelgo",risciogli:"risciolgo",risii:"risono",risostieni:"risostengo",risovvieni:"risovvengo",rista:"ristò","ristà":"ristò",ristai:"ristò",ritieni:"ritengo",ritogli:"ritolgo",ritrai:"ritraggo",riva:"rivado",rivai:"rivado",rivali:"rivalgo",rivuoi:"rivoglio",sali:"salgo",sappi:"so",scegli:"scelgo",sciogli:"sciolgo",scompari:"scompaio",scompiaci:"scompiaccio",scomponi:"scompongo",sconvieni:"sconvengo",scuci:"scucio",scuoci:"scuocio",sfa:"sfaccio",sfai:"sfaccio",sii:"sono",soggiaci:"soggiaccio",sopraffa:"sopraffaccio",sopraffai:"sopraffaccio",sopravvieni:"sopravvengo",sostieni:"sostengo",sottaci:"sottaccio",sottoesponi:"sottoespongo",sottoponi:"sottopongo",sottosta:"sottostò","sottostà":"sottostò",sottostai:"sottostò",sottrai:"sottraggo",sovraesponi:"sovraespongo",sovrapponi:"sovrappongo",sovresponi:"sovrespongo",sovvieni:"sovvengo",spegni:"spengo",spiaci:"spiaccio",sta:"sto",stai:"sto",stracuoci:"stracuocio",strafa:"strafaccio",strafai:"strafaccio",stupefa:"stupefaccio",stupefai:"stupefaccio",suoli:"soglio",supponi:"suppongo",svieni:"svengo",taci:"taccio",tieni:"tengo",togli:"tolgo",torrefa:"torrefaccio",torrefai:"torrefaccio",trai:"traggo",trascegli:"trascelgo",traspari:"traspaio",trasponi:"traspongo",trattieni:"trattengo",tumefa:"tumefaccio",tumefai:"tumefaccio",va:"vado",vai:"vado",vali:"valgo",vieni:"vengo",vogli:"voglio",vuoi:"voglio"};if(a[b]!==undefined){return a[b]}else{return b.substr(0,b.length-1)+"o"}},normalizzaDiacritici:function(b){for(var a=0;a<Lingua.mappaDiacritici.length;a++){b=b.replace(Lingua.mappaDiacritici[a].letters,Lingua.mappaDiacritici[a].base)}return b},articolaFrasi:function(g){var d=[];var f=0;var e=[];var c=[];var h=0;for(h=0;h<g.length;h++){g[h]=g[h].split("|");c.push(g[h].length);e.push(0)}do{d.push("");for(h=0;h<g.length;h++){if(h===0){d[f]+=g[h][e[h]]}else{d[f]+=" "+g[h][e[h]]}}f++;h=0;var b;do{b=0;e[h]++;if(e[h]===c[h]){e[h]=0;h++;if(h===e.length){return d}b=1}}while(b===1)}while(true)},disarticolaEspressioniEq:function(i,a){var e=[];if(a===1){e=[i]}else{var d=[0];var c=0;var b=[0,0];var h=[];do{b[0]=i.indexOf("[",d[c]);b[1]=i.indexOf("|",d[c]);if(b[0]!==-1&&(b[1]===-1||b[0]<b[1])){d.push(b[0]);c++;if(d[c-1]!==d[c]){h.push(i.substr(d[c-1],d[c]-d[c-1]))}d[c]++;d.push(i.indexOf("]",d[c]));c++;h.push(i.substr(d[c-1],d[c]-d[c-1]));d[c]++}else{if(b[1]!==-1&&(b[0]===-1||b[1]<b[0])){d.push(b[1]);c++;if(d[c-1]!==d[c]){h.push(i.substr(d[c-1],d[c]-d[c-1]))}d[c]++;if(h.length>0){e=e.concat(Lingua.articolaFrasi(h))}h=[]}else{d.push(i.length);c++;if(d[c-1]!==d[c]){h.push(i.substr(d[c-1],d[c]-d[c-1]))}if(h.length>0){e=e.concat(Lingua.articolaFrasi(h))}h=[];break}}}while(true)}for(var g=0;g<e.length;g++){e[g]=e[g].split(/(?:[ '‛‘’`´]+)|([,?!]+)/).filter(Boolean)}if(a===1){return e[0]}else{return e}},normalizzaInput:function(l,j){l=Lingua.normalizzaDiacritici(l.toLowerCase());var g=Lingua.disarticolaEspressioniEq(l,j);var b=[];var a=0;if(j===1){g=[g]}for(var i=0;i<g.length;i++){b[i]=[];for(var d=0;d<g[i].length;d++){b[i][d]=[];b[i][d].push(g[i][d]);if(Lingua.equivalenzeOrd[g[i][d]]!==undefined){var e=0;for(var c=0;c<Lingua.equivalenzeOrd[g[i][d]].length;c++){var m=Lingua.equivalenzeOrd[g[i][d]][c];if(m.substring(0,2)==="__"){b[i][d].push(m.substring(2,m.length));if(e===0&&g[i].length>1){b[i][d]=[""].concat(b[i][d]);e=1}}else{b[i][d].push(m)}}}if(j===1&&d===0){var k="";if(b[i][0][0]===""){k=b[i][0][1]}else{k=b[i][0][0]}var h="";h=Lingua.normalizzaImperativo(k);if(h!==k){if(Lingua.equivalenzeOrd[h]===undefined){b[i][0].push(h)}else{var e=0;for(var c=0;c<Lingua.equivalenzeOrd[h].length;c++){var m=Lingua.equivalenzeOrd[h][c];if(m.substring(0,2)==="__"){b[i][d].push(m.substring(2,m.length));if(e===0&&g[i].length>1&&b[i][d][0]!==""){b[i][d]=[""].concat(b[i][d]);e=1}}else{b[i][d].push(m)}}}}}}}if(j===1){return b[0]}else{return b}},fraseInFrasiSemantiche:function(b,j){for(var d=0;d<j.length;d++){var e=0;var i=0;for(var a=0;a<b.length;a++){var g=0;i=0;if(j[d][a+e]===undefined){break}for(var c=0;c<b[a].length;c++){for(var h=0;h<j[d][a+e].length;h++){if(b[a][c]===j[d][a+e][h]){g=1;i=0;break}else{if(i===0&&j[d][a+e][0]===""){i=1}}}if(g===1){break}}if(g===0&&i===0){break}if(i===1){e++;a--}}if(g===1&&j[d][b.length+e]===undefined){return true}}return false}};var Vista={cronoInput:[],nCronoInput:0,caricamento:0,intermezzo:[],istroInizioScena:[],attesaImmagini:0,timerImmagini:0,hTestoP:0,testo:"",uscite:"",scelte:"",messaggiRifiuto:[],timerFineRifiuto:0,stile:{},coloreTestoP:"",effetti:[],nEffetti:0,timerEffetto:null,timerPremiTasto:0,preparaScena:function(a){if(Vista.caricamento===0){Vista.caricamento=1}if(a===1){S.nuovaPartita();Vista.caricamento=0;G.nScena=0;istruzioniGenerali();G.nScena=1;G.nScenaP=1;G.nScenaPP=1}G.nScenaPP=G.nScenaP;G.nScenaP=G.nScena;G.nScena=a;if(G.passaggiScena[G.nScenaP]===undefined){G.passaggiScena[G.nScenaP]=[]}if(G.nScena!==G.nScenaP&&G.passaggiScena[G.nScenaP].indexOf(G.nScena)===-1){G.passaggiScena[G.nScenaP].push(G.nScena);if(G.passaggiScena[G.nScena]===undefined){G.passaggiScena[G.nScena]=[]}G.passaggiScena[G.nScena].push(G.nScenaP)}Vista.svuotaScena();Vista.attesaImmagini=1},svuotaScena:function(){clearTimeout(Vista.timerEffetto);Vista.timerEffetto=null;Vista.effetti=[];Vista.nEffetti=0;G.luoghiRagg.bloccati=0;Vista.intermezzo=undefined;Vista.testo="";Vista.uscite="";Vista.scelte="";document.getElementById("audio").innerHTML="";document.getElementById("scelte").style.visibility="hidden";document.getElementById("scelte").innerHTML="";document.getElementById("input").style.display="none";document.getElementById("input").value="? ";document.getElementById("testo").style.visibility="hidden";document.getElementById("testo").innerHTML="";Vista.stile={};var b=document.getElementById("corpo");var a=document.getElementById("input");b.style.backgroundColor=null;a.style.backgroundColor=null;b.style.color=null;a.style.color=null;document.getElementById("scelte").style.color=null;b.style.fontFamily=null;a.style.fontFamily=null;b.style.fontSize=null;a.style.fontSize=null;b.style.textAlign=null;a.style.textAlign=null;S.Istruzioni.scena=[];I.inputGrezzo=""},mostra:function(){var j=document.getElementById("testo");if(Vista.intermezzo===undefined){Vista.intermezzo=[];Vista.istroInizioScena=[];var d=["generali","scena"];d.forEach(function(i){for(var k=0;k<S.Istruzioni[i].length;k++){if(S.Istruzioni[i][k].soloInizioScena===1){if(S.Istruzioni[i][k].azione==="intermezzo"){if(I.controllaCondizioni(i,k)){Vista.intermezzo.push(S.Istruzioni[i][k])}}else{if(I.controllaCondizioni(i,k)){Vista.istroInizioScena.push(S.Istruzioni[i][k])}}if(i==="scena"||S.Istruzioni[i][k].autoElimina){S.Istruzioni[i].splice(k,1);k--}}}})}if(Vista.intermezzo.length>0){j.innerHTML="";I.eseguiIstruzione(Vista.intermezzo[0]);Vista.intermezzo.shift();return}else{j.style.visibility="hidden"}if(Vista.attesaImmagini===1){Vista.stile.titolo=document.title;j.innerHTML="";for(var e=0;e<Vista.istroInizioScena.length;e++){I.eseguiIstruzione(Vista.istroInizioScena[e])}j.innerHTML=Vista.testo;Vista.attesaImmagini=2;Vista.timerImmagini=setTimeout(Vista.mostra,100);return}else{if(Vista.attesaImmagini>1){var h=document.getElementsByTagName("img");for(var e=0;e<h.length;e++){if(h[e].naturalWidth===0){Vista.timerImmagini=setTimeout(Vista.mostra,100);if(Vista.attesaImmagini>31){document.title="Attesa "+(13-Math.floor(Vista.attesaImmagini/10))}if(Vista.attesaImmagini<131){Vista.attesaImmagini++;return}else{h[e].parentNode.removeChild(h[e])}}}Vista.attesaImmagini=0;clearTimeout(Vista.timerImmagini);document.title=Vista.stile.titolo;delete Vista.stile.titolo;Vista.testo=j.innerHTML}}if(Vista.uscite!==""){var g="";if(Vista.stile.testoAllineamento){g=Vista.cssAll(Vista.stile.testoAllineamento)}Vista.testo+="<p"+g+">Uscite visibili:"+Vista.uscite.substr(1)+".</p>"}j.innerHTML=Vista.testo;document.getElementById("scelte").innerHTML=Vista.scelte;var c=document.getElementById("corpo");var b=document.getElementById("input");if(Vista.stile.coloreSfondo){c.style.backgroundColor=Vista.stile.coloreSfondo;b.style.backgroundColor=Vista.stile.coloreSfondo}if(Vista.stile.coloreTesto){c.style.color=Vista.stile.coloreTesto;b.style.color=Vista.stile.coloreTesto}if(Vista.stile.testoCarattere){c.style.fontFamily=Vista.stile.testoCarattere;b.style.fontFamily=Vista.stile.testoCarattere}if(Vista.stile.testoGrandezza){c.style.fontSize=Vista.stile.testoGrandezza+"px";b.style.fontSize=Vista.stile.testoGrandezza+"px"}if(Vista.stile.testoAllineamento){var g;switch(Vista.stile.testoAllineamento){case"giustificato":g="justify";break;case"centrato":g="center";break;case"destra":g="right";break;case"sinistra":g="left";break}c.style.textAlign=g;b.style.textAlign=g}if(Vista.stile.coloreScelta||Vista.stile.coloreSceltaSelez){var a=document.getElementsByClassName("scelta");if(Vista.stile.coloreScelta){for(var e=0;e<a.length;e++){a[e].style.color=Vista.stile.coloreScelta}}if(Vista.stile.coloreSceltaSelez){for(var e=0;e<a.length;e++){a[e].addEventListener("mouseenter",function(){this.style.color=Vista.stile.coloreSceltaSelez});if(Vista.stile.coloreScelta){a[e].addEventListener("mouseout",function(){this.style.color=Vista.stile.coloreScelta})}else{a[e].addEventListener("mouseout",function(){this.style.color=null})}}}}j.style.visibility="visible";if(Vista.stile.inputBox===1){document.getElementById("input").style.display="block"}if(Vista.scelte!==""){document.getElementById("scelte").style.visibility="visible"}var f=document.getElementById("fileAudio");if(f!==null){f.play()}Vista.caricamento=0;G.pronto()},misuraHTesto:function(){return document.getElementById("testo").offsetHeight+document.getElementById("testo").offsetTop},misuraHContenuto:function(){var a=Vista.misuraHTesto();if(document.getElementById("scelte").style.visibility==="visible"){a=document.getElementById("scelte").offsetTop+document.getElementById("scelte").offsetHeight}else{if(document.getElementById("input").style.display==="block"){a=document.getElementById("input").offsetTop+document.getElementById("input").offsetHeight}}return a},fondoPagina:function(){var a=Vista.misuraHTesto();var b=Vista.misuraHContenuto();var c=b-window.innerHeight;if(c>0){if(c-window.pageYOffset<window.innerHeight){window.scroll(0,c+8)}else{window.scroll(0,Vista.hTestoP)}}},annullaTabLink:function(){var a=document.getElementsByClassName("tabLink");if(a.length!==0){a[0].classList.remove("tabLink")}},eseguiAudio:function(b){var a=document.getElementById("audio");a.innerHTML='<audio src="'+Risorse[b]+'" autoplay="autoplay"></audio>'},scorriCronoInput:function(b){setTimeout(G.pronto,100);if(Vista.cronoInput.length===0){return}var a=document.getElementById("input");Vista.nCronoInput=Vista.nCronoInput+b;if(Vista.nCronoInput<0){Vista.nCronoInput=0}if(Vista.nCronoInput>Vista.cronoInput.length-1){Vista.nCronoInput=Vista.cronoInput.length;a.value="? "}else{a.value="? "+Vista.cronoInput[Vista.nCronoInput]}},cssAll:function(a){switch(a){case"giustificato":case"justify":a=' style="text-align:justify;"';break;case"centrato":case"center":a=' style="text-align:center;"';break;case"destra":case"right":a=' style="text-align:right;"';break;case"sinistra":case"left":a=' style="text-align:left;"';break;default:return""}return a},testoSpeciale:function(d){var c=[];var b=d.indexOf("x(");if(b!==-1){c.push(Vista.contenitori(d.substr(0,b)));var a=d.indexOf(")",b+2);var f=d.substr(b+2,a-b-2).split("|");var e=Math.floor((Math.random()*f.length));c.push(Vista.contenitori(f[e]));c.push(Vista.contenitori(d.substr(a+1,d.length-a)))}else{c.push(Vista.contenitori(d))}return c.join("")},contenitori:function(c){var a=[];a=c.split("@");if(a.length<3){return c}for(var b=1;b<a.length;b++){if(S.oggetti[a[b]]!==undefined){a[b]=Vista.contenuto(a[b]);b++}else{a[b]="@"+a[b]}}return a.join("")},contenuto:function(a){if(S.oggetti[a][0].length===0){return"niente"}else{if(I.istroLivello==="scena"){return S.oggetti[a][1].join(", ")}else{return S.oggetti[a][0].join(", ")}}},fineRifiuto:function(a){document.removeEventListener("keydown",Vista.fineRifiuto);document.removeEventListener("click",Vista.fineRifiuto);clearTimeout(Vista.timerFineRifiuto);if(Vista.timerFineRifiuto===undefined){return}Vista.timerFineRifiuto=undefined;var b=document.getElementById("input");b.value="? ";b.style.color=Vista.coloreTestoP;b.className="coloreSfondo coloreTesto testoCarattere testoGrandezza larghezzaMaxStoria";b.readOnly=false;if(a!==undefined&&a.keyCode===38){b.disabled=true;Vista.scorriCronoInput(-1)}else{setTimeout(G.pronto,100)}},passaIntermezzo:function(){document.removeEventListener("keydown",Vista.passaIntermezzo);document.removeEventListener("click",Vista.passaIntermezzo);clearTimeout(Vista.timerPremiTasto);Vista.mostra()},premiUnTasto:function(){var a=document.getElementById("testo");a.innerHTML+="<p>[Premi un tasto per continuare]</p>"},prossimaScena:function(){document.removeEventListener("keydown",Vista.prossimaScena);document.removeEventListener("click",Vista.prossimaScena);clearTimeout(Vista.timerPremiTasto);istruzioniScena(G.nScenaPP)},avanzaEffetto:function(){if(Vista.caricamento===1){return}var b=document.getElementById(Vista.effetti[0].IDelem);if(b===null){var a=document.getElementById("testo");a.innerHTML+='<p id="'+Vista.effetti[0].IDelem+'"'+Vista.effetti[0].stile+">&nbsp;</p>";b=document.getElementById(Vista.effetti[0].IDelem)}switch(Vista.effetti[0].tipo){case"testo-caratteri":case"testo-parole":if(Vista.effetti[0].contatore===0){b.innerHTML=Vista.effetti[0].output[Vista.effetti[0].contatore]}else{b.innerHTML+=Vista.effetti[0].output[Vista.effetti[0].contatore]}Vista.effetti[0].contatore++;if(Vista.effetti[0].contatore>=Vista.effetti[0].output.length){clearTimeout(Vista.timerEffetto);Vista.timerEffetto=null;Vista.effetti.shift();if(Vista.effetti.length>=1){Vista.timerEffetto=setInterval(Vista.avanzaEffetto,Vista.effetti[0].intervallo)}}break}Vista.fondoPagina()}};var I={inputGrezzo:"",inputNorm:[],istroLivello:"",leggiInput:function(){var e=document.getElementById("input");I.inputGrezzo=e.value.trim();if(I.inputGrezzo.charAt(0)==="?"){I.inputGrezzo=I.inputGrezzo.substr(1).trim()}if(I.inputGrezzo===""){e.value="? ";G.pronto();return}if(I.inputGrezzo!==Vista.cronoInput[Vista.cronoInput.length-1]){Vista.cronoInput.push(I.inputGrezzo)}if(Vista.cronoInput.length===21){Vista.cronoInput.shift()}Vista.nCronoInput=Vista.cronoInput.length;I.inputNorm=Lingua.normalizzaInput(I.inputGrezzo,1);var m;var b=0;var p=0;m={};if(/^(quit|exit|esco|esci)$/.test(I.inputNorm[0][0])){m.frasi=Lingua.normalizzaInput("[quit|exit]|esco da [gioco|storia|partita|avventura|avventura testuale]",2);if(Lingua.fraseInFrasiSemantiche(I.inputNorm,m.frasi)){m.azione="rispondi";m.input=I.inputGrezzo;m.output="<span class=\"coloreTestoInviato\">Per uscire chiudi la scheda del navigatore Web. Se desideri ricominciare daccapo puoi aggiornare la pagina del navigatore o scrivere 'restart'.</span>";I.eseguiIstruzione(m);e.value="? ";return}}m={};if(/^(restart|riavvio|riavvia|ricomincio|ricomincia)$/.test(I.inputNorm[0][0])){m.frasi=Lingua.normalizzaInput("restart|[riavvio|ricomincio] il [gioco|storia|partita|avventura|avventura testuale]",2);if(Lingua.fraseInFrasiSemantiche(I.inputNorm,m.frasi)){m.azione="rispondi";m.input=I.inputGrezzo;m.output="<span class=\"coloreTestoInviato\">Ricaricare tutto comporterà la perdita delle informazioni sulla partita in corso. Per confermare scrivi 'restart!' o 'riavvia!' o 'ricomincio!' con il punto esclamativo.</span>";I.eseguiIstruzione(m);e.value="? ";return}}m={};if(I.inputNorm.length===2&&/^(restart|riavvio|riavvia|ricomincio|ricomincia)$/.test(I.inputNorm[0][0])&&/^!$/.test(I.inputNorm[1][0])){m.azione="rispondiVai";m.input=I.inputGrezzo;m.output='<span class="coloreTestoInviato">Ricarico tutto dall\'inizio...</span>';m.scena=1;I.eseguiIstruzione(m);e.value="? ";return}m={};if(I.inputNorm.length===1&&/^istruzioni$/.test(I.inputNorm[0][0])){m.azione="rispondi";m.input=I.inputGrezzo;m.output='<span class="coloreTestoInviato">'+G.istruzioni+"</span>";I.eseguiIstruzione(m);e.value="? ";return}m={};if(I.inputNorm.length===1&&/^(save|salva|salvo)$/.test(I.inputNorm[0][0])){m.azione="rispondi";m.input=I.inputGrezzo;m.output="<span class=\"coloreTestoInviato\">Specificare il numero della posizione da 0 a 9 in cui salvare. Esempio: 'save 2'. I salvataggi saranno disponibili solo sul navigatore Web in cui sono stati registrati. Per eliminare tutti i salvataggi scrivere 'save reset'.</span>";I.eseguiIstruzione(m);e.value="? ";return}else{if(I.inputNorm.length===2&&/^(save|salva|salvo)$/.test(I.inputNorm[0][0])&&/^[0-9]{1}$/.test(I.inputNorm[1][0])){m.azione="rispondi";m.input=I.inputGrezzo;if(typeof(Storage)!=="undefined"){try{localStorage.setItem(document.title+" "+I.inputNorm[1][0],[G.nScena,G.nScenaP,G.nScenaPP,JSON.stringify(G.passaggiScena),JSON.stringify(G.luoghiRagg),JSON.stringify(S.oggetti),JSON.stringify(S.variabili),JSON.stringify(S.Istruzioni.generali),JSON.stringify(S.Istruzioni.scena)].join("§§"));m.output='<span class="coloreTestoInviato">Partita salvata in posizione '+I.inputNorm[1][0]+"</span>"}catch(i){m.output="<span class=\"coloreRifiuto\">Impossibile salvare la partita.</span> <span class=\"coloreTestoInviato\">Questo navitagore Web nega l'accesso all'HTML5 storage da parte dei file locali. Se state usando Chrome o Chromium la soluzione è probabilmente questa: spostarsi in alto a destra e cliccare sul menu generale con l'icona <strong>፧</strong> ; cliccare su Impostazioni (Settings); scorrere le sezioni fino in fondo e cliccare su Avanzate (Advanced); nella sezione Privacy e sicurezza (Privacy and Security), cliccare su Impostazioni contenuti (Content Settings); poi cliccare sulla prima voce Cookie; \"Blocca cookie di terze parti\" probabilmente è attivo, ma può rimanere così; aggiungere un'eccezione per i file locali cliccando su Aggiungi (Add) alla voce Consenti (Allow); inserire nella casella di testo quanto segue: file:///* e cliccare sul pulsante Aggiungi (Add). D'ora in avanti Chrome o Chromium permetteranno ai file html sul vostro PC di salvare qualche dato nell'HTML5 storage. Ricaricate questa pagina html ed i salvataggi dovrebbero funzionare.</span>"}}else{m.output='<span class="coloreRifiuto">Impossibile salvare la partita.</span> <span class="coloreTestoInviato">Questo navigatore Web non supporta l\'HTML5 storage. Per salvare e caricare le partite si deve utilizzare un navigatore Web moderno che supporti questa funzionalità.</span>'}I.eseguiIstruzione(m);e.value="? ";return}else{if(I.inputNorm.length===2&&/^(save|salva|salvo)$/.test(I.inputNorm[0][0])&&/^reset$/.test(I.inputNorm[1][0])){for(var q=0;q<10;q++){localStorage.removeItem(document.title+" "+q)}m.azione="rispondi";m.input=I.inputGrezzo;m.output='<span class="coloreTestoInviato">Tutti i salvataggi per '+document.title+" sono stati eliminati.</span>";I.eseguiIstruzione(m);e.value="? ";return}}}m={};if(I.inputNorm.length===1&&/^(load|carica|carico)$/.test(I.inputNorm[0][0])){m.azione="rispondi";m.input=I.inputGrezzo;m.output="<span class=\"coloreTestoInviato\">Specificare il numero della posizione da 0 a 9 da cui caricare. Esempio: 'load 2'. Per eliminare tutti i salvataggi scrivere 'save reset'.</span>";I.eseguiIstruzione(m);e.value="? ";return}else{if(I.inputNorm.length===2&&/^(load|carica|carico)$/.test(I.inputNorm[0][0])&&/^[0-9]{1}$/.test(I.inputNorm[1][0])){var d=localStorage.getItem(document.title+" "+I.inputNorm[1][0]);if(d===null||d===undefined){m.azione="rispondi";m.input=I.inputGrezzo;m.output='<span class="coloreTestoInviato">Nella posizione '+I.inputNorm[1][0]+" non risulta alcun salvataggio.</span>";I.eseguiIstruzione(m);e.value="? "}else{d=d.split("§§");G.nScena=Number(d[0]);G.passaggiScena=JSON.parse(d[3]);G.luoghiRagg=JSON.parse(d[4]);S.oggetti=JSON.parse(d[5]);S.variabili=JSON.parse(d[6]);istruzioniScena(G.nScena);S.Istruzioni.generali=JSON.parse(d[7]);S.Istruzioni.scena=JSON.parse(d[8]);G.nScenaP=Number(d[1]);G.nScenaPP=Number(d[2]);e.value="? "}return}}m={};if(I.inputNorm.length===1&&/^(direzioni|direzione|d)$/.test(I.inputNorm[0][0])){if(I.inputGrezzo==="d"){I.inputGrezzo="direzioni"}m.azione="rispondi";m.input=I.inputGrezzo;if(Vista.uscite===""||G.luoghiRagg.bloccati===1){m.output="Ora non puoi dirigerti velocemente in nessun luogo."}else{if(G.luoghiRagg.nomi.length===0||(G.luoghiRagg.nomi.length===1&&G.luoghiRagg.coppie[G.nScena]!==undefined)){m.output="Ancora non puoi dirigerti velocemente in nessun luogo."}else{m.output="Luoghi raggiungibili: "+G.luoghiRagg.nomi.join(", ")+"."}}I.eseguiIstruzione(m);b=1}else{if(I.inputNorm.length>1&&/^(direzione|d)$/.test(I.inputNorm[0][0])&&G.luoghiRagg.bloccati===1){m.azione="rispondi";m.input=I.inputGrezzo;m.output="Ora non puoi dirigerti velocemente in nessun luogo.";I.eseguiIstruzione(m);b=1}}var j=["scena","generali"];var g=[];var l=1;do{if(l===2){I.inputGrezzo="osserva "+I.inputGrezzo;I.inputNorm=Lingua.normalizzaInput(I.inputGrezzo,1)}j.forEach(function(a){for(var o=0;o<S.Istruzioni[a].length;o++){if(b===1&&S.Istruzioni[a][o].input!==undefined){continue}if(l===2&&S.Istruzioni[a][o].mossa!==undefined){continue}if(Vista.caricamento===1&&S.Istruzioni[a][o].mossa!==undefined){continue}if(a==="generali"&&S.Istruzioni[a][o].soloInizioScena===1){continue}if(I.controllaCondizioni(a,o)){if(S.Istruzioni[a][o].input!==undefined){b=1}g.push([a,o])}}});l++}while(l===2&&b===0&&!/^(esamino|esamina|x|osservo|osserva)$/.test(I.inputNorm[0][1]));var h=[];var k=0;for(var f=0;f<4;f++){if(g.length===0){break}for(var n=0;n<g.length;n++){if(p===1&&g[n][0]==="scena"){continue}switch(f){case 0:if(S.Istruzioni[g[n][0]][g[n][1]].mosse===undefined&&(S.Istruzioni[g[n][0]][g[n][1]].azione==="vaiA"||S.Istruzioni[g[n][0]][g[n][1]].azione==="rispondiVai")){I.eseguiIstruzione(S.Istruzioni[g[n][0]][g[n][1]]);p=1;if(g[n][0]==="generali"&&S.Istruzioni.generali[g[n][1]].autoElimina){h=["generali",g[n][1],n]}g.splice(n,1);n--}break;case 1:if(S.Istruzioni[g[n][0]][g[n][1]].mosse!==undefined&&(S.Istruzioni[g[n][0]][g[n][1]].azione==="vaiA"||S.Istruzioni[g[n][0]][g[n][1]].azione==="rispondiVai")){if(I.controllaCondizioni(g[n][0],g[n][1],"no!nMosse")){I.eseguiIstruzione(S.Istruzioni[g[n][0]][g[n][1]]);p=1;if(g[n][0]==="generali"&&S.Istruzioni.generali[g[n][1]].autoElimina){h=["generali",g[n][1],n]}g.splice(n,1);n--}}break;case 2:if(k===0&&S.Istruzioni[g[n][0]][g[n][1]].input!==undefined&&S.Istruzioni[g[n][0]][g[n][1]].azione!=="vaiA"&&S.Istruzioni[g[n][0]][g[n][1]].azione!=="rispondiVai"){if(I.controllaCondizioni(g[n][0],g[n][1],"no!nMosse")){I.eseguiIstruzione(S.Istruzioni[g[n][0]][g[n][1]]);k=1;if(S.Istruzioni[g[n][0]][g[n][1]].autoElimina){h=[g[n][0],g[n][1],n]}g.splice(n,1);n--}}break;case 3:if(S.Istruzioni[g[n][0]][g[n][1]].mosse!==undefined&&S.Istruzioni[g[n][0]][g[n][1]].azione!=="vaiA"&&S.Istruzioni[g[n][0]][g[n][1]].azione!=="rispondiVai"){if(I.controllaCondizioni(g[n][0],g[n][1],"no!nMosse")){I.eseguiIstruzione(S.Istruzioni[g[n][0]][g[n][1]]);if(S.Istruzioni[g[n][0]][g[n][1]].autoElimina){h=[g[n][0],g[n][1],n]}g.splice(n,1);n--}}break}if(h.length>0){if(p===0||h[0]==="generali"){S.Istruzioni[h[0]].splice(h[1],1);for(var c=h[2];c<g.length;c++){if(h[0]===g[c][0]){g[c][1]--}}}h=[]}}}if(p===1){return}I.inputGrezzo="";if(b===0){e.readOnly=true;e.className="coloreSfondo testoCarattere testoGrandezza larghezzaMaxStoria";if(e.style.color){Vista.coloreTestoP=e.style.color}if(Vista.stile.coloreRifiuto){e.style.color=Vista.stile.coloreRifiuto}else{e.className+=" coloreRifiuto"}e.value=Vista.messaggiRifiuto[Math.floor((Math.random()*Vista.messaggiRifiuto.length))];Vista.timerFineRifiuto=setTimeout(Vista.fineRifiuto,1000);setTimeout(function(){document.addEventListener("keydown",Vista.fineRifiuto);document.addEventListener("click",Vista.fineRifiuto)},100)}else{e.value="? "}Vista.fondoPagina()},scriviInput:function(a){document.getElementById("input").value="? "+a;I.leggiInput()},controllaCondizioni:function(a,d,f){if(S.Istruzioni[a][d].seVariabili===undefined&&S.Istruzioni[a][d].seOggetti===undefined&&S.Istruzioni[a][d].mosse===undefined&&S.Istruzioni[a][d].input===undefined){return true}var b=S.Istruzioni[a][d];var e=2;if(b.seVariabili!==undefined){for(var c=0;c<b.seVariabili.length;c++){if(S.variabili[b.seVariabili[c].nome]===undefined){if(b.seVariabili[c].presenza===1){e=0}}else{if(b.seVariabili[c].presenza===0){e=0}}}}if(e!==0&&b.seOggetti!==undefined){for(var c=0;c<b.seOggetti.length;c++){if(S.oggetti[b.seOggetti[c].contenitore]===undefined||S.oggetti[b.seOggetti[c].contenitore][0].indexOf(b.seOggetti[c].nome)===-1){if(b.seOggetti[c].presenza===1){e=0}}else{if(b.seOggetti[c].presenza===0){e=0}}}}if(b.mosse!==undefined&&f!=="no!nMosse"){if(b.mossa===undefined){e=0}else{if(e===0){S.Istruzioni[a][d].mossa=0}else{if(b.mossa>=b.mosse){S.Istruzioni[a][d].mossa=0}else{S.Istruzioni[a][d].mossa++;e=0}}}}if(e!==0&&b.input!==undefined){if(!Lingua.fraseInFrasiSemantiche(I.inputNorm,b.input)){e=0}}if(e===0){return false}return true},impostaOggVar:function(e){e=e.split("  ");var f;var c;var b;for(var d=0;d<e.length;d++){if(e[d].substr(0,3)==="no!"){f=0;e[d]=e[d].substr(3)}else{f=1}if(e[d].indexOf("@")!==-1){e[d]=e[d].split("@");c=e[d][0];b=e[d][1];if(f===1){if(S.oggetti[b]===undefined){S.oggetti[b]=[];S.oggetti[b].push([]);S.oggetti[b].push([])}if(S.oggetti[b][0].indexOf(c)===-1){S.oggetti[b][0].push(c);S.oggetti[b][1].push(c)}}else{if(S.oggetti[b]!==undefined){var a=S.oggetti[b][0].indexOf(c);if(a!==-1){S.oggetti[b][0].splice(a,1);S.oggetti[b][1].splice(a,1)}}}}else{if(f===1){if(S.variabili[e[d]]===undefined){S.variabili[e[d]]=1}}else{if(S.variabili[e[d]]!==undefined){delete S.variabili[e[d]]}}}}},eseguiIstruzione:function(e){I.istroLivello=e.livello;var j=document.getElementById("testo");Vista.hTestoP=Vista.misuraHTesto();if(e.immagine){if(e.w===undefined){e.w=""}else{e.w=' width="'+e.w+'"'}if(e.h===undefined){e.h=""}else{e.h=' height="'+e.h+'"'}if(e.sostituisci===1){var i=document.getElementsByTagName("img");i[i.length-1].outerHTML='<img style="display:block;" '+e.w+e.h+' src="'+Risorse[e.immagine]+'" />';Vista.testo=j.innerHTML}else{Vista.testo+='<img style="display:block;" '+e.w+e.h+' src="'+Risorse[e.immagine]+'" />'}}if(e.oggetti){I.impostaOggVar(e.oggetti)}if(e.variabili){I.impostaOggVar(e.variabili)}if(e.audio){Vista.eseguiAudio(e.audio)}var h="";if(e.allineamento){h=Vista.cssAll(e.allineamento)}if(!h&&Vista.stile.testoAllineamento){h=Vista.cssAll(Vista.stile.testoAllineamento)}var a="";var g="";if(I.inputGrezzo===""&&e.input!==undefined){I.inputGrezzo=e.input}switch(e.azione){case"coloreSfondo":Vista.stile.coloreSfondo=e.colore;break;case"coloreTesto":Vista.stile.coloreTesto=e.colore1;if(e.colore2){Vista.stile.coloreTestoInviato=e.colore2}break;case"coloreScelte":Vista.stile.coloreScelta=e.colore1;if(e.colore2){Vista.stile.coloreSceltaSelez=e.colore2}break;case"coloreRifiuto":Vista.stile.coloreRifiuto=e.colore;break;case"impostaMsgRifiuto":Vista.messaggiRifiuto=e.messaggi.split("|");break;case"carattereTesto":if(e.font){Vista.stile.testoCarattere=e.font}if(e.size){Vista.stile.testoGrandezza=e.size}if(e.align){Vista.stile.testoAllineamento=e.align}break;case"bloccaDirezioni":G.luoghiRagg.bloccati=1;break;case"cancellaDirezione":if(S.luoghiRagg[e.nome]!==undefined){delete S.luoghiRagg[e.nome]}break;case"intermezzo":j.innerHTML+="<p>"+Vista.testoSpeciale(e.testo)+"</p>";j.style.visibility="visible";setTimeout(function(){document.addEventListener("keydown",Vista.passaIntermezzo);document.addEventListener("click",Vista.passaIntermezzo)},100);Vista.timerPremiTasto=setTimeout(Vista.premiUnTasto,5000);break;case"testo":if(e.align==="no!p"){Vista.testo+=Vista.testoSpeciale(e.testo)}else{if(e.align){e.align=Vista.cssAll(e.align)}else{if(Vista.stile.testoAllineamento){e.align=Vista.cssAll(Vista.stile.testoAllineamento)}else{e.align=""}}Vista.testo+="<p"+e.align+">"+Vista.testoSpeciale(e.testo)+"</p>"}break;case"creaContenitore":S.oggetti[e.nome]=[];if(e.ogg===""||e.ogg===undefined){S.oggetti[e.nome].push([]);S.oggetti[e.nome].push([])}else{var f=[];var d=[];e.ogg=e.ogg.split("+");for(var b=0;b<e.ogg.length;b++){e.ogg[b]=e.ogg[b].split("|");switch(e.ogg[b].length){case 1:f.push(e.ogg[b][0]);d.push(e.ogg[b][0]);break;case 2:f.push(e.ogg[b][1]);if(e.ogg[b][1].startsWith("gli")){d.push(e.ogg[b][0]+e.ogg[b][1].substring(3))}else{if(e.ogg[b][1].startsWith("gl'")){if(e.ogg[b][0].substring(e.ogg[b][0].length-1)==="'"){d.push(e.ogg[b][0]+e.ogg[b][1].substring(3))}else{d.push(e.ogg[b][0]+" "+e.ogg[b][1].substring(3))}}else{if(e.ogg[b][1].match(/^il|lo|la|le/)){d.push(e.ogg[b][0]+e.ogg[b][1].substring(2))}else{if(e.ogg[b][1].startsWith("l'")){if(e.ogg[b][0].substring(e.ogg[b][0].length-1)==="'"){d.push(e.ogg[b][0]+e.ogg[b][1].substring(2))}else{d.push(e.ogg[b][0]+" "+e.ogg[b][1].substring(2))}}else{if(e.ogg[b][1].startsWith("i")){d.push(e.ogg[b][0]+e.ogg[b][1].substring(1))}}}}}break;default:alert("Un'etichetta presenta più di un separatore ammesso per l'articolo indeterminativo. Correggere la scena n. "+G.nScena);return}}S.oggetti[e.nome].push(f);S.oggetti[e.nome].push(d)}break;case"scegliRispondi":if(e.al1!==undefined){e.al1=Vista.cssAll(e.al1)}else{e.al1=""}if(e.output!==undefined&&e.output!==""){var k={};k.azione="rispondi";k.input=e.nome;k.output=e.output.replace(/'/g,'"');if(e.al2!==undefined){e.allineamento=e.al2}Vista.scelte+='<p class="scelta coloreScelta" '+e.al1+' onclick="this.remove(); I.eseguiIstruzione('+JSON.stringify(k).replace(/"/g,"'")+'); Vista.fondoPagina();">'+e.nome+"</p>"}else{if(e.al2!==undefined){e.al2=", {'outAli':'"+e.al2+"'}"}else{e.al2=""}e.nome=e.nome.replace(/'/g,'"').replace(/"/g,"'");Vista.scelte+='<p class="scelta coloreScelta" '+e.al1+" onclick=\"this.remove(); I.scriviInput('"+e.nome+"'"+e.al2+');">'+e.nome+"</p>"}break;case"scegliVai":if(e.all!==undefined){e.all=Vista.cssAll(e.all)}else{e.all=""}Vista.scelte+='<p class="scelta coloreScelta" '+e.all+' onclick="S.vaiA('+e.nS+')">'+e.nome+"</p>";break;case"rispondi":if(e.input!==undefined){a=' class="inviato';if(Vista.stile.coloreTestoInviato){g=' style="color:'+Vista.stile.coloreTestoInviato+';"'}else{a+=" coloreTestoInviato"}a+='"';j.innerHTML+="<p"+h+g+a+">? "+I.inputGrezzo+"</p>"}j.innerHTML+="<p"+h+">"+Vista.testoSpeciale(e.output)+"</p>";I.inputGrezzo="";break;case"vaiA":switch(e.scena){case 0:istruzioniScena(G.nScena);break;case -1:istruzioniScena(G.nScenaP);break;case -2:istruzioniScena(G.nScenaPP);break;default:istruzioniScena(e.scena);break}break;case"rispondiVai":document.getElementById("input").style.display="none";if(e.input!==undefined){a=' class="inviato';if(Vista.stile.coloreTestoInviato){g=' style="color:'+Vista.stile.coloreTestoInviato+';"'}else{a+=" coloreTestoInviato"}a+='"';j.innerHTML+="<p"+h+g+a+">? "+I.inputGrezzo+"</p>"}j.innerHTML+="<p"+h+">"+Vista.testoSpeciale(e.output)+"</p>";G.nScenaPP=e.scena;setTimeout(function(){document.addEventListener("keydown",Vista.prossimaScena);document.addEventListener("click",Vista.prossimaScena)},100);Vista.timerPremiTasto=setTimeout(Vista.premiUnTasto,5000);break;case"effetto":if(e.colore!==undefined){g=' style="color:'+e.colore+';"'}Vista.nEffetti++;Vista.effetti.push({IDelem:"ef"+Vista.nEffetti});Vista.effetti[Vista.effetti.length-1].stile=e.all+g;Vista.effetti[Vista.effetti.length-1].tipo=e.tipo;Vista.effetti[Vista.effetti.length-1].contatore=0;switch(e.tipo){case"testo-caratteri":Vista.effetti[Vista.effetti.length-1].output=e.output;break;case"testo-parole":var c=[];c=e.output.split(/([^\s]+\s)/).filter(Boolean);Vista.effetti[Vista.effetti.length-1].output=c;break}Vista.effetti[Vista.effetti.length-1].intervallo=e.intervallo;if(Vista.timerEffetto===null){Vista.timerEffetto=setInterval(Vista.avanzaEffetto,e.intervallo)}break}Vista.fondoPagina()}};var G={nScena:1,nScenaP:1,nScenaPP:1,passaggiScena:{},luoghiRagg:{bloccati:0,nomi:[],coppie:{}},istruzioni:"",nuovaPartita:function(){G.passaggiScena={};G.luoghiRagg={};G.luoghiRagg.bloccati=0;G.luoghiRagg.nomi=[];G.luoghiRagg.coppie={}},pronto:function(){var a=document.getElementById("input");a.disabled=false;a.focus();a.setSelectionRange(a.value.length,a.value.length)},uscitaEsplorata:function(a){if(G.passaggiScena[G.nScena]!==undefined&&G.passaggiScena[G.nScena].indexOf(a)!==-1){return true}return false}};var S={oggetti:{},variabili:{},nuovaPartita:function(){if(Lingua.equivalenzeOrd.length!==0){vocabolario()}G.nuovaPartita();S.oggetti={};S.variabili={};S.Istruzioni.generali=[]},vaiA:function(a){switch(a){case 0:istruzioniScena(G.nScena);break;case -1:istruzioniScena(G.nScenaP);break;case -2:istruzioniScena(G.nScenaPP);break;default:istruzioniScena(a);break}},Istruzioni:{generali:[],scena:[],crea:function(){if(G.nScena===0){S.Istruzioni.generali.push({})}else{S.Istruzioni.scena.push({})}},valore:function(b,a){if(G.nScena===0){S.Istruzioni.generali[S.Istruzioni.generali.length-1][b]=a}else{S.Istruzioni.scena[S.Istruzioni.scena.length-1][b]=a}},valoreArray:function(b,c){var d;if(G.nScena===0){d=S.Istruzioni.generali.length-1;if(S.Istruzioni.generali[d][b]===undefined){S.Istruzioni.generali[d][b]=[]}S.Istruzioni.generali[d][b].push(c)}else{d=S.Istruzioni.scena.length-1;if(S.Istruzioni.scena[d][b]===undefined){S.Istruzioni.scena[d][b]=[]}S.Istruzioni.scena[d][b].push(c)}},leggiValore:function(a){if(G.nScena===0){return S.Istruzioni.generali[S.Istruzioni.generali.length-1][a]}else{return S.Istruzioni.scena[S.Istruzioni.scena.length-1][a]}},aggiungiCondizioni:function(){var a;if(G.nScena===0){a="generali"}else{a="scena"}var b=Condizioni.blocchi.length-1;if(Condizioni.righeCoinvolte[b]>0){var c=S.Istruzioni[a].length-1;S.Istruzioni[a][c]["seOggetti"]=Condizioni.somma.seOggetti;S.Istruzioni[a][c]["seVariabili"]=Condizioni.somma.seVariabili;if(Condizioni.righeCoinvolte[b]===1){Condizioni.popBlocco()}}},annullaCondizioni:function(){var a=Condizioni.blocchi.length-1;if(Condizioni.righeCoinvolte[a]===1){Condizioni.popBlocco()}}}};var Condizioni={blocchi:[],somma:{},righeCoinvolte:[],creaSomma:function(){Condizioni.somma={seOggetti:[],seVariabili:[]};for(var a=0;a<Condizioni.blocchi.length;a++){Condizioni.somma.seOggetti=Condizioni.somma.seOggetti.concat(Condizioni.blocchi[a].seOggetti);Condizioni.somma.seVariabili=Condizioni.somma.seVariabili.concat(Condizioni.blocchi[a].seVariabili)}},popBlocco:function(){Condizioni.righeCoinvolte.pop();Condizioni.blocchi.pop();Condizioni.creaSomma()}};function nomeStoria(a){document.title=a}function nomeLuogo(a){if(G.nScena===0){alert('L\'istruzione "nomeLuogo()" nelle istruzioni generali non ha senso. Eliminarla.');return}a=a.split("|");if(!G.luoghiRagg.coppie[G.nScena]||!G.luoghiRagg.coppie[a[0]]){G.luoghiRagg.nomi.push(a[0]);G.luoghiRagg.coppie[G.nScena]=a[0];G.luoghiRagg.coppie[a[0]]=G.nScena;var b=G.nScena;var c="";G.nScena=0;S.Istruzioni.crea();S.Istruzioni.valore("azione","vaiA");S.Istruzioni.valore("scena",b);c="direzione "+a.join("|direzione ");c=Lingua.normalizzaInput(c,2);S.Istruzioni.valore("input",c);G.nScena=b}}function istruzioni(a){G.istruzioni=a}function condizioni(d,a){var c=Condizioni.blocchi.length;Condizioni.blocchi.push({seOggetti:[],seVariabili:[]});var e;d=d.split("  ");for(var b=0;b<d.length;b++){if(d[b].indexOf("@")!==-1){if(d[b].substr(0,3)==="no!"){e=0;d[b]=d[b].substr(3)}else{e=1}d[b]=d[b].split("@");Condizioni.blocchi[c].seOggetti.push({presenza:e,nome:d[b][0],contenitore:d[b][1]})}else{if(d[b].substr(0,3)==="no!"){e=0;d[b]=d[b].substr(3)}else{e=1}Condizioni.blocchi[c].seVariabili.push({presenza:e,nome:d[b]})}}Condizioni.creaSomma();if(a!==undefined){Condizioni.righeCoinvolte.push(2);a();Condizioni.popBlocco()}else{Condizioni.righeCoinvolte.push(1)}}function carattereTesto(b,a,c){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","carattereTesto");if(b){S.Istruzioni.valore("font",b)}if(a){S.Istruzioni.valore("size",a)}if(c){S.Istruzioni.valore("align",c)}S.Istruzioni.aggiungiCondizioni()}function coloreSfondo(a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","coloreSfondo");S.Istruzioni.valore("colore",a);S.Istruzioni.aggiungiCondizioni()}function coloreTesto(b,a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","coloreTesto");if(b){S.Istruzioni.valore("colore1",b)}if(a){S.Istruzioni.valore("colore2",a)}S.Istruzioni.aggiungiCondizioni()}function coloreScelte(b,a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","coloreScelte");if(b){S.Istruzioni.valore("colore1",b)}if(a){S.Istruzioni.valore("colore2",a)}S.Istruzioni.aggiungiCondizioni()}function coloreRifiuto(a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","coloreRifiuto");S.Istruzioni.valore("colore",a);S.Istruzioni.aggiungiCondizioni()}function messaggiRifiuto(a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","impostaMsgRifiuto");S.Istruzioni.valore("messaggi",a);S.Istruzioni.aggiungiCondizioni()}function intermezzo(a){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","intermezzo");S.Istruzioni.valore("testo",a);S.Istruzioni.aggiungiCondizioni()}function testo(a,b){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","testo");S.Istruzioni.valore("testo",a);S.Istruzioni.valore("align",b);S.Istruzioni.aggiungiCondizioni()}function immagine(b,a,c){if(b===undefined||b===""){S.Istruzioni.annullaCondizioni();return}S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","immagine");S.Istruzioni.valore("immagine",b);S.Istruzioni.valore("w",a);S.Istruzioni.valore("h",c);S.Istruzioni.aggiungiCondizioni()}function uscita(e,b,d,a){S.Istruzioni.crea();S.Istruzioni.valore("azione","vaiA");S.Istruzioni.valore("scena",b);if(d===undefined){d="visibile"}if(d!=="invisibile"){var c=e.split("|")[0];if(["esplorato","esplorata"].indexOf(d)!==-1||G.uscitaEsplorata(b)){if(a){e+="|"+a+"|"+c+" "+a;a="&nbsp;("+a+")"}else{if(G.luoghiRagg.coppie[b]!==undefined){a="&nbsp;("+G.luoghiRagg.coppie[b]+")";e+="|"+G.luoghiRagg.coppie[b];e+="|"+c+" "+G.luoghiRagg.coppie[b]}else{a="&nbsp;(esplorato)"}}}else{a=""}if(["visibile","esplorato","esplorata"].indexOf(d)!==-1||(d==="esplorabile"&&a!=="")){Vista.uscite+=', <a class="scelta coloreScelta" onclick="I.scriviInput(\''+c+"')\">"+c+"</a>"+a}}e=Lingua.normalizzaInput(e,2);S.Istruzioni.valore("input",e);S.Istruzioni.aggiungiCondizioni()}function contenitore(a,b){if(S.oggetti[a]!==undefined){S.Istruzioni.annullaCondizioni();return}S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("autoElimina",1);S.Istruzioni.valore("azione","creaContenitore");S.Istruzioni.valore("nome",a);S.Istruzioni.valore("ogg",b);S.Istruzioni.aggiungiCondizioni()}function scegliRispondi(a,c,d,b){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","scegliRispondi");S.Istruzioni.valore("nome",a);S.Istruzioni.valore("output",c);S.Istruzioni.valore("al1",d);S.Istruzioni.valore("al2",b);S.Istruzioni.aggiungiCondizioni()}function scegliVai(a,b,c){S.Istruzioni.crea();S.Istruzioni.valore("soloInizioScena",1);S.Istruzioni.valore("azione","scegliVai");S.Istruzioni.valore("nome",a);S.Istruzioni.valore("nS",b);S.Istruzioni.valore("all",c);S.Istruzioni.aggiungiCondizioni()}function bloccaDirezioni(){S.Istruzioni.crea();S.Istruzioni.valore("azione","bloccaDirezioni");S.Istruzioni.aggiungiCondizioni()}function cancellaDirezione(a){S.Istruzioni.crea();S.Istruzioni.valore("azione","cancellaDirezione");S.Istruzioni.valore("nome",a);S.Istruzioni.aggiungiCondizioni()}function rispondi(b,a){b=Lingua.normalizzaInput(b,2);S.Istruzioni.crea();S.Istruzioni.valore("azione","rispondi");S.Istruzioni.valore("input",b);S.Istruzioni.valore("output",a);S.Istruzioni.aggiungiCondizioni();Vista.stile.inputBox=1}function rispondiVai(c,b,a){c=Lingua.normalizzaInput(c,2);S.Istruzioni.crea();S.Istruzioni.valore("azione","rispondiVai");S.Istruzioni.valore("input",c);S.Istruzioni.valore("output",b);S.Istruzioni.valore("scena",a);S.Istruzioni.aggiungiCondizioni();Vista.stile.inputBox=1}function nMosseRispondi(a,b){S.Istruzioni.crea();S.Istruzioni.valore("mosse",a-1);S.Istruzioni.valore("mossa",0);S.Istruzioni.valore("azione","rispondi");S.Istruzioni.valore("output",b);S.Istruzioni.aggiungiCondizioni();Vista.stile.inputBox=1}function nMosseVai(a,b,c){S.Istruzioni.crea();S.Istruzioni.valore("mosse",a-1);S.Istruzioni.valore("mossa",0);if(c===undefined){S.Istruzioni.valore("azione","vaiA")}else{S.Istruzioni.valore("azione","rispondiVai");S.Istruzioni.valore("output",c)}S.Istruzioni.valore("scena",b);S.Istruzioni.aggiungiCondizioni();Vista.stile.inputBox=1}function effetto(d,b,a,j,h,g,f){var e=[b,a,j,h,g,f];S.Istruzioni.crea();S.Istruzioni.valore("azione","effetto");S.Istruzioni.valore("tipo",d);switch(d){case"testo-caratteri":case"testo-parole":var c=0;S.Istruzioni.valore("output",e[0]);c++;if(/^(giustificato|centrato|destra|sinistra|justify|center|right|left)$/.test(e[c])){S.Istruzioni.valore("all",e[c]);c++}if(/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e[c])){S.Istruzioni.valore("colore",e[c]);c++}S.Istruzioni.valore("intervallo",Number(e[c]));break}S.Istruzioni.aggiungiCondizioni()}function nMosseEffetto(a,f,h,g,e,d,c,b){effetto(f,h,g,e,d,c,b);S.Istruzioni.valore("mosse",a-1);S.Istruzioni.valore("mossa",0)}function __oggetti(a){S.Istruzioni.valore("oggetti",Lingua.normalizzaDiacritici(a.toLowerCase()))}function __variabili(a){S.Istruzioni.valore("variabili",Lingua.normalizzaDiacritici(a.toLowerCase()))}function __audio(a){S.Istruzioni.valore("audio",a)}function __immagine(b,a,c,d){S.Istruzioni.valore("immagine",b);if(a!==undefined){S.Istruzioni.valore("w",a)}if(c!==undefined){S.Istruzioni.valore("h",c)}if(d==="sostituisci"){S.Istruzioni.valore("sostituisci",1)}}function __inizioScena(a){if(a===0||a===false){S.Istruzioni.valore("soloInizioScena",0)}else{S.Istruzioni.valore("soloInizioScena",1)}}function __autoElimina(a){if(a===0||a===false){S.Istruzioni.valore("autoElimina",0)}else{S.Istruzioni.valore("autoElimina",1)}}function x(b){var a=b.split("|");var c=Math.floor((Math.random()*a.length));if(isNaN(a[c])){return a[c]}else{return Number(a[c])}};